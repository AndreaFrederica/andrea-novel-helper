# 时间线嵌套节点快速指南

## 🚀 快速开始

### 运行开发服### 示例 3: 在亲代节点内创建子节点
1. 点击节点的“完整编辑”按钮
2. 查看节点ID，或者右键节点 → “复制”
3. 创建新节点或编辑现有节点
4. 设置：
   ```
   标题: 最终和解
   开始时间: 2024-01-10T15:00:00
   
   【嵌套和布局配置】
   亲代节点: <从下拉框选择>
   ✓ 限制在亲代节点内移动
   ✓ 自动扩展亲代节点
   ```
5. 保存后节点出现在亲代节点内ell
pixi run dev
```

### 打开测试文件
在 VS Code 中打开:
```
test-files/nested-nodes-timeline.tjson5
```

## 📝 功能演示

### 示例 1: 查看嵌套节点
测试文件包含:
- **第一章:相遇** (亲代节点, 400x300)
  - 早晨偶遇 (子节点)
  - 午后交谈 (子节点)
- **第二章:冲突** (亲代节点, 400x250)
  - 误会产生 (子节点)

### 示例 2: 创建新的亲代节点
1. 点击画布空白处右键 → "创建节点"
2. 或使用已有节点,点击"完整编辑"
3. 在编辑器中设置:
   ```
   标题: 第三章:和解
   开始时间: 2024-01-10T09:00:00
   结束时间: 2024-01-10T18:00:00
   
   【嵌套和布局配置】
   宽度: 450
   高度: 350
   ```
4. 保存后看到绿色半透明容器

### 示例 3: 在亲代节点内创建子节点
1. 复制亲代节点的 ID (在节点上右键 → "复制")
2. 创建新节点或编辑现有节点
3. 设置:
   ```
   标题: 最终和解
   开始时间: 2024-01-10T15:00:00
   
   【嵌套和布局配置】
   亲代节点ID: <粘贴刚才复制的 ID>
   ✓ 限制在亲代节点内移动
   ✓ 自动扩展亲代节点
   ```
4. 保存后节点出现在亲代节点内

### 示例 4: 时间区间显示
节点会自动根据时间格式显示:
- **有结束时间**: `2024-01-01 08:30 ~ 09:00`
- **单个时间点**: `2024-01-01 08:30`
- **纯日期** (00:00:00): `2024-01-01`

## ⌨️ 快捷操作

### 右键菜单
- **画布右键**: 创建节点 / 粘贴节点
- **节点右键**: 复制 / 剪切 / 删除 / 编辑

### 复制/粘贴节点
1. 右键节点 → "复制"
2. 右键画布 → "粘贴"
3. 新节点会自动生成新 UUID

## 🎨 视觉标识

### 亲代节点样式
- 背景: 半透明绿色
- 边框: 绿色 2px 实线
- 圆角: 8px
- 内边距: 10px

### 子节点
- 在亲代节点内部渲染
- 拖动时受限于亲代节点范围 (如果启用 extent)
- 拖到边缘会扩大亲代节点 (如果启用 expandParent)

### 时间区间
- 单个时间点: 正常显示日期时间
- 时间区间: 显示 开始 ~ 结束
- 纯日期 (00:00:00): 隐藏时间部分

## 🔗 连线支持

所有连线类型都支持嵌套节点:
- ✅ 亲代节点 → 亲代节点
- ✅ 子节点 → 子节点
- ✅ 亲代节点 → 子节点
- ✅ 跨亲代节点连线
- ✅ 自循环 (节点连到自己)

## 📊 数据格式示例

```json
{
  "events": [
    {
      "id": "parent-1",
      "title": "第一章",
      "date": "2024-01-01T08:00:00",
      "endDate": "2024-01-01T18:00:00",
      "width": 400,
      "height": 300,
      "position": { "x": 100, "y": 100 }
    },
    {
      "id": "child-1",
      "title": "场景A",
      "date": "2024-01-01T09:00:00",
      "parentNode": "parent-1",
      "extent": "parent",
      "expandParent": true,
      "position": { "x": 20, "y": 50 }
    }
  ]
}
```

## 💡 提示

1. **亲代节点ID获取**: 右键节点 → 复制,粘贴到编辑器的"亲代节点ID"字段
2. **解除嵌套**: 清空"亲代节点ID"字段
3. **调整亲代节点大小**: 修改 width/height 数值
4. **时间精确到秒**: 使用格式 `2024-01-01T14:30:45`
5. **自循环连线**: 拖动节点右侧手柄到左侧手柄

## 🐛 常见问题

**Q: 子节点不显示在亲代节点内?**
A: 检查:
1. 亲代节点ID是否正确
2. 亲代节点是否设置了 width/height
3. 子节点的 position 是否在亲代节点范围内

**Q: 时间显示格式不对?**
A: 确保使用 ISO 8601 格式,例如 `2024-01-01T08:30:00`

**Q: 无法拖动子节点到亲代节点外?**
A: 取消勾选 "限制在亲代节点内移动" (extent)

**Q: 亲代节点不会自动扩大?**
A: 勾选 "自动扩展亲代节点" (expandParent)

# 亲代节点选择器使用示例

## 🎬 场景演示

### 场景 1: 为现有节点设置亲代

假设你已经创建了以下节点:
- "第一章:相遇" (id: chapter-1)
- "早晨的咖啡馆" (id: scene-1)

现在想让"早晨的咖啡馆"成为"第一章:相遇"的子节点:

#### 步骤:
1. 双击"早晨的咖啡馆"节点,或点击其"完整编辑"按钮
2. 在编辑器中找到 **"嵌套和布局配置"** 部分
3. 点击 **"亲代节点"** 下拉框
4. 从列表中选择 **"第一章:相遇 (chapter-1...)"**
5. 勾选 **"限制在亲代节点内移动"** (推荐)
6. 点击 **"保存"**

**结果**: "早晨的咖啡馆"节点会移动到"第一章:相遇"节点内部。

---

### 场景 2: 创建亲代容器

你想创建一个新的章节容器来组织多个场景:

#### 步骤:
1. 右键点击画布空白处 → **"创建节点"**
2. 填写基本信息:
   ```
   标题: 第二章:冲突升级
   分组: 主线剧情
   类型: 主要事件
   开始时间: 2024-01-10T08:00:00
   结束时间: 2024-01-10T20:00:00
   描述: 矛盾激化的一天
   ```
3. 在 **"嵌套和布局配置"** 中设置:
   ```
   亲代节点: (留空 - 这是顶层节点)
   节点宽度: 500
   节点高度: 400
   ```
4. 点击 **"保存"**

**结果**: 创建了一个绿色半透明的容器节点,可以容纳子节点。

---

### 场景 3: 批量组织子节点

你有多个独立场景,想把它们都放到同一个亲代节点下:

已有节点:
- "第三章:和解" (亲代节点,id: chapter-3)
- "道歉" (id: scene-a)
- "原谅" (id: scene-b)
- "重新开始" (id: scene-c)

#### 步骤:
对每个场景节点重复以下操作:

1. 打开节点编辑器
2. 在 **"亲代节点"** 下拉框中选择 **"第三章:和解 (chapter-3...)"**
3. 勾选 **"限制在亲代节点内移动"**
4. 勾选 **"自动扩展亲代节点"** (可选)
5. 保存

**结果**: 三个场景节点都会出现在"第三章:和解"容器内。

---

### 场景 4: 解除亲代关系

你想让一个子节点变回独立节点:

#### 步骤:
1. 打开子节点的编辑器
2. 点击 **"亲代节点"** 下拉框右侧的 **✕ (清空)** 按钮
3. 保存

**结果**: 节点变回独立节点,可以在画布上自由移动。

---

## 🔍 下拉框选项说明

### 选项格式
```
<节点标题> (<节点ID前8位>...)
```

### 选项过滤规则

#### ✅ 会显示的节点:
- 独立的顶层节点(没有亲代)
- 标题不同于当前节点
- 已设置 width 和 height 的节点(推荐作为容器)

#### ❌ 不会显示的节点:
- **当前正在编辑的节点** - 防止自己成为自己的亲代
- **已有亲代的节点** - 防止嵌套过深(目前限制为两层)

### 空选项提示
如果看到 **"无可用的亲代节点"**,可能是因为:
1. 所有节点都已经是子节点
2. 只有当前节点存在
3. 需要先创建一个容器节点(设置 width/height)

---

## 💡 最佳实践

### 1. 先创建容器
创建亲代节点时,建议:
- 设置合理的 `width` (推荐 400-600)
- 设置合理的 `height` (推荐 300-500)
- 使用描述性的标题,如"第一章"、"主线剧情"等

### 2. 子节点配置
为子节点设置亲代时,建议:
- ✅ 勾选 **"限制在亲代节点内移动"**
- ✅ 勾选 **"自动扩展亲代节点"**
- ✅ 设置合理的 `position`,确保在亲代范围内

### 3. 避免的情况
- ❌ 不要创建太多层嵌套(目前最多两层)
- ❌ 不要让亲代节点太小,无法容纳子节点
- ❌ 不要频繁改变亲代关系,影响布局稳定性

---

## 🎨 视觉效果

### 亲代节点
- **背景**: 半透明绿色 `rgba(16, 185, 129, 0.15)`
- **边框**: 绿色实线 `2px solid rgba(16, 185, 129, 0.5)`
- **圆角**: 8px
- **内边距**: 10px

### 子节点
- **正常样式**: 根据类型(主要/次要)显示颜色
- **位置**: 相对于亲代节点的左上角
- **移动**: 可在亲代范围内自由拖动(如果启用限制)

---

## 🐛 常见问题

### Q: 为什么找不到某个节点作为亲代?
**A**: 检查:
1. 该节点是否已经是其他节点的子节点
2. 该节点是否就是当前正在编辑的节点
3. 是否有任何独立的顶层节点可用

### Q: 选择亲代后节点消失了?
**A**: 节点没有消失,而是移动到了亲代节点内部。检查:
1. 亲代节点是否有足够的尺寸
2. 子节点的 position 是否在亲代范围内
3. 尝试拖动亲代节点查看

### Q: 如何查看节点的完整ID?
**A**: 
1. 打开节点编辑器
2. ID 显示在编辑器标题栏或表单顶部
3. 也可以查看 .tjson5 文件源代码

### Q: 可以一次选择多个亲代节点吗?
**A**: 不可以。每个节点只能有一个亲代节点。

### Q: 如何创建三层嵌套?
**A**: 目前系统限制为两层(亲代-子节点)。未来版本可能支持更深嵌套。

---

## 📖 相关文档

- [嵌套节点实现文档](./nested-nodes-implementation.md)
- [快速使用指南](./nested-nodes-quick-guide.md)
- [测试验证清单](./nested-nodes-test-checklist.md)
- [UI改进总结](./nested-nodes-ui-improvements.md)

---

**提示**: 如有任何问题或建议,欢迎在 GitHub Issues 中反馈!

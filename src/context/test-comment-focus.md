# 批注面板焦点豁免功能测试

## 测试目的
验证当焦点移动到批注面板时，写作统计功能不会被打断，实现与预览面板相同的豁免机制。

## 测试步骤

### 1. 准备测试环境
1. 打开一个支持的文档文件（如 .md 或 .txt）
2. 确保 TimeStats 功能已启用
3. 开始写作，观察状态栏显示的统计信息

### 2. 测试批注面板焦点豁免
1. 在文档中写入一些内容，确保写作会话已开始
2. 选中一段文本，右键选择"添加批注"或使用快捷键
3. 批注面板打开后，观察以下行为：
   - 状态栏的写作统计应该保持活跃状态
   - 不应该出现会话结束的提示
   - suspendedByCommentPanel 标记应该被设置为 true

### 3. 测试焦点返回
1. 在批注面板中输入批注内容
2. 点击回到原文档编辑器
3. 观察以下行为：
   - 写作会话应该无缝恢复
   - suspendedByCommentPanel 标记应该被清除
   - 继续写作时统计应该正常累加

### 4. 测试多次切换
1. 重复在文档编辑器和批注面板之间切换焦点
2. 确保每次切换都不会打断写作统计
3. 验证统计数据的连续性和准确性

## 预期结果

- ✅ 批注面板获得焦点时，写作统计不会被打断
- ✅ 焦点返回编辑器时，统计会话无缝恢复
- ✅ 多次焦点切换不影响统计的连续性
- ✅ 调试日志中显示正确的面板状态信息

## 调试信息

可以通过以下方式查看调试信息：
1. 在 VS Code 开发者控制台中查看 `panel-return:skip-end-on-race` 日志
2. 观察 `suspendedByCommentPanel` 和 `suspendedByPreview` 的状态变化
3. 确认 `isAnyPanelActive()` 函数正确检测批注面板状态

## 注意事项

- 此功能依赖于 `commentRedirect.ts` 模块正确跟踪批注面板状态
- 批注控制器必须在面板创建/销毁时正确调用 `setActiveCommentPanel()`
- 与预览面板的豁免机制保持一致的行为模式